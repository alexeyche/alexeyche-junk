d = sapply(1:nrow(centroids), function(i) mean(sqrt((xc - centroids[i,1])^2 + (yc - centroids[i,2])^2 )))
dist_means = rbind(dist_means, d)
for(other_lab in lab_spikes$labels) {
if(other_lab != lab) {
labj = which(other_lab == lab_spikes$labels)
cdist[labi, labj] = sqrt((centroids[labi,1] - centroids[labj,1])^2 + (centroids[labi,2] - centroids[labj,2])^2)
}
}
}
cdist
dist_means
dist_means
centroids = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
xc = x[ci]
yc = y[ci]
centroids = rbind(centroids, c(mean(xc), mean(yc)))
}
dist_means = NULL
cdist = matrix(0, nrow=nrow(centroids), ncol=nrow(centroids))
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
xc = x[ci]
yc = y[ci]
d = sapply(1:nrow(centroids), function(i) mean(sqrt((xc - centroids[i,1])^2 + (yc - centroids[i,2])^2 )))
dist_means = rbind(dist_means, d)
for(other_lab in lab_spikes$labels) {
if(other_lab != lab) {
labj = which(other_lab == lab_spikes$labels)
cdist[labi, labj] = sqrt((centroids[labi,1] - centroids[labj,1])^2 + (centroids[labi,2] - centroids[labj,2])^2)
}
}
}
dist_means
dist_means[labi, ]
dist_means[labj, labi]
dist_means
labi
labj
cor(x,y)
x
,y
y
x %*% y
x %*% t(y)
gr_pl(x %*% t(y))
centroids
centroids[1,]
dist_xy = function(x_y1, x_y2) {
sqrt((x_y1[1] - x_y2[1])^2 + (x_y1[2] - x_y2[2])^2)
}
x
x_y = cbind(x,y)
x_y
sapply(1:ncol(x_y), function(i) dist_xy(x_y[1,], centroids[1, ]) )
sapply(1:ncol(x_y), function(i) dist_xy(x_y[i,], centroids[1, ]) )
x_y[1,]
sapply(1:ncol(x_y), function(i) dist_xy(x_y[i,], centroids[1, ]) )
sapply(1:nrow(x_y), function(i) dist_xy(x_y[i,], centroids[1, ]) )
sapply(1:nrow(x_y), function(i) dist_xy(x_y[i,], centroids[1, ]) )
distances_to_centroids = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
d = sapply(1:nrow(x_y), function(i) dist_xy(x_y[labi,], centroids[1, ]) )
distances_to_centroids = cbind(distances_to_centroids, d)
}
distances_to_centroids
dist_to_c = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
d = sapply(1:nrow(x_y), function(i) dist_xy(x_y[i,], centroids[labi, ]) )
dist_to_c = cbind(dist_to_c, d)
}
dist_to_c
centroids
total_centroid =  c(mean(x), mean(y))
total_centroid
x
fit = cmdscale(dist, 2, eig=TRUE)
x <- fit$points[,1]
y <- fit$points[,2]
plot(x, y, xlab="Coordinate 1", ylab="Coordinate 2",
main="Metric    MDS",	type="n")
lab_cols = rainbow(length(lab_spikes$labels))
text(x, y, labels = lab_spikes$labels[lab_spikes$labels_id_timeline+1], cex=.7, col=lab_cols[lab_spikes$labels_id_timeline+1])
x_y = cbind(x,y)
dist_xy = function(x_y1, x_y2) {
sqrt((x_y1[1] - x_y2[1])^2 + (x_y1[2] - x_y2[2])^2)
}
total_centroid =  c(mean(x), mean(y))
centroids = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
xc = x[ci]
yc = y[ci]
centroids = rbind(centroids, c(mean(xc), mean(yc)))
}
dist_to_c = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
d = sapply(1:nrow(x_y), function(i) dist_xy(x_y[i,], centroids[labi, ]) )
dist_to_c = cbind(dist_to_c, d)
}
points(centroids, lwd=10, pch=3, col=lab_cols)
points(total_centroid, lwd=10, pch=3, col="black")
total_centroid
points(total_centroid, lwd=10, pch=3, col="black")
points(0,0, lwd=10, pch=3, col="black")
total_centroid
total_centroid
centroids
total_centroid =  matrix(c(mean(x), mean(y)), nrow=1, ncol=2)
fit = cmdscale(dist, 2, eig=TRUE)
x <- fit$points[,1]
y <- fit$points[,2]
plot(x, y, xlab="Coordinate 1", ylab="Coordinate 2",
main="Metric    MDS",	type="n")
lab_cols = rainbow(length(lab_spikes$labels))
text(x, y, labels = lab_spikes$labels[lab_spikes$labels_id_timeline+1], cex=.7, col=lab_cols[lab_spikes$labels_id_timeline+1])
x_y = cbind(x,y)
dist_xy = function(x_y1, x_y2) {
sqrt((x_y1[1] - x_y2[1])^2 + (x_y1[2] - x_y2[2])^2)
}
total_centroid =  matrix(c(mean(x), mean(y)), nrow=1, ncol=2)
centroids = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
xc = x[ci]
yc = y[ci]
centroids = rbind(centroids, c(mean(xc), mean(yc)))
}
dist_to_c = NULL
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
d = sapply(1:nrow(x_y), function(i) dist_xy(x_y[i,], centroids[labi, ]) )
dist_to_c = cbind(dist_to_c, d)
}
points(centroids, lwd=10, pch=3, col=lab_cols)
points(total_centroid, lwd=10, pch=3, col="black")
dist_to_c
dist_to_cd
d
dist_to_c
sse = 0
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
d = dist_to_c[ci,labi]
sse = sse + d^2
}
sse
sse = 0
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
d = dist_to_c[ci,labi]
sse = sse + sum(d^2)
}
sse
ci
ci
labi
centroid
centroids
dist_xy(centroids[labi,], total_centroid)
sse = 0
bss = 0
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
d = dist_to_c[ci,labi]
sse = sse + sum(d^2)
bss = bss + length(d)*dist_xy(centroids[labi,], total_centroid)
}
bss
sse = 0
bss = 0
for(lab in lab_spikes$labels) {
labi = which(lab == lab_spikes$labels)
ci = which(lab_spikes$labels_id_timeline == labi-1)
d = dist_to_c[ci,labi]
sse = sse + sum(d^2)
bss = bss + length(d)*dist_xy(centroids[labi,], total_centroid)^2
}
bss
sse
sse+bss
sse-bss
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/eval_dist_matrix.R', echo=TRUE)
gr_pl(dist)
require(Rsnn)
gr_pl(dist)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
sse
bss
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
sse
bss
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
bss
sse
d
ifrom
ito
pairs
m1
gr_pl(m1)
gr_pl(m2)
dist
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
gr_pl(dist)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
x_y
centroids
total_centroid
labs
labs
?unique
rle(labs)
?rl
?rle
table(labs)
table(labs)[1]
which(lab == labs)
points[which(lab == labs)]
points = x_y
points[which(lab == labs)]
labi
labi=1
cpoints = points[which(lab == labs)]
d = sapply(1:nrow(cpoints), function(i) dist_xy(x_y[i,], centroids[labi, ]) )
points
cpoints = points[which(lab == labs),]
cpoints
d = sapply(1:nrow(cpoints), function(i) dist_xy(x_y[i,], centroids[labi, ]) )
d
sapply(points, function(x) x*2)
d = sapply(1:nrow(cpoints), function(i) dist_xy(cpoints[i,], centroids[labi, ]) )
d
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
cluster_lengths = table(labs)
ss_b = 0
cluster_length
cluster_lengths
labi=1
labi = which(lab == ulabs)
cluster_lengths[labi]
dist_xy(centroids[labi,], global_centroid)^2
centroids[labi,]
global_centroid
centroids[labi,]
(centroids[labi,])^2
sum((centroids[labi,])^2)
sqrt(sum((centroids[labi,])^2))
(centroids[labi,])^2
sum((centroids[labi,])^2)
sqrt(sum((centroids[labi,])^2))
dist_xy(centroids[labi,], global_centroid)
dist_xy(centroids[labi,], global_centroid)^2
ss_b
ss_b = 0
for(lab in ulabs) {
labi = which(lab == ulabs)
ss_b = ss_b + cluster_lengths[labi]*dist_xy(centroids[labi,], global_centroid)^2
}
ss_bn
ss_b
ss_w = 0
for(lab in ulabs) {
labi = which(lab == ulabs)
cpoints = points[which(lab == labs),]
d = sapply(1:nrow(cpoints), function(i) dist_xy(cpoints[i,], centroids[labi, ]) )
ss_w = ss_w + sum(d^2)
}
labs
points
points = cbind(x,y)
ss_w = 0
for(lab in ulabs) {
labi = which(lab == ulabs)
cpoints = points[which(lab == labs),]
d = sapply(1:nrow(cpoints), function(i) dist_xy(cpoints[i,], centroids[labi, ]) )
ss_w = ss_w + sum(d^2)
}
ss_w
nrow(points)-k
k = length(ulabs)
(nrow(points)-k)/(k-1)
ss_w
ss_b
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
(ss_b/ss_w)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
net[101:200]
sapply(net[101:200], length)
sapply(net[101:200], length)/9000
mean(sapply(net[101:200], length)/9000)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
sapply(net[101:200], length)/9000
mean(sapply(net[101:200], length)/9000)
args <- commandArgs(trailingOnly = FALSE)
arg_i = grep("--args", args)
if(length(arg_i) == 0) {
f = "/home/alexeyche/prog/alexeyche-junk/cns/cpp/out.json"
} else {
f = args[arg_i+1]
}
require(rjson)
f
fromJSON(f)
fromJSON(file = f)
data = fromJSON(file = f)
data$distance_matrix
dist = do.call(rbind, data$distance_matrix)
dim(dist)
gr_pl(dist)
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
plot(x, y, xlab="Coordinate 1", ylab="Coordinate 2", main="Metric MDS",    type="n")
lab_cols = rainbow(length(ulabs))
text(x, y, labels = labs, cex=.7, col=lab_cols[sapply(labs, function(l) which(l == ulabs))])
points(centroids, lwd=10, pch=3, col=lab_cols)
points(global_centroid, lwd=10, pch=3, col="black")
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
invisible(require(rjson))
?require
require(rjson, quietly=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/scripts/eval_dist_matrix.R', echo=TRUE)
calinski_harabasz_criterion(points, ulabs, labs, centroids, global_centroid)
data$mean_rate
args
rpoiss(1000, 0.01)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/cross_spectrum_dist_test.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/cross_spectrum_dist_test.R', echo=TRUE)
s1
s2
plotl(s2)
plot(s2)
plot(s2, type="l")
plot(s1, type="l")
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/cross_spectrum_dist_test.R', echo=TRUE)
plot(s1, type="l")
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/cross_spectrum_dist_test.R', echo=TRUE)
s1
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
ep
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/get_sim_data.R', echo=TRUE)
ep
install.packages('RMongo')
require(RMongo)
install.packages('rmongodb')
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
?rmongodb
??rmongodb
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
mongo
mongo.get.databases(mongo)
mongo.get.database.collections(mongo, "spearmint")
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
mongo.find("pearmint", coll)
mongo.find("spearmint", coll)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
mongo.count(mongo, coll)
mongo.find.one(mongo, coll)
mongo.find.all(mongo, coll)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
d
d[[1]]
d[[1]]$values
sapply(d, function(x) x$values)
sapply(d, function(x) x$values$cluster_criterion)
sapply(d, function(x) x$values$cluster_criterion)
source('~/.active-rstudio-document', echo=TRUE)
unlist(cr)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
cr
plotl(cr)
d[[1]]
d[[1]]$params
names(d[[1]]$params)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
pars
d[[1]]$params
d[[1]]$params$tau_c
install.packages('base64')
require(base64)
require(base64, quetly=TRUE)
require(base64, quietly=TRUE)
d[[1]]$params$tau_c
d[[1]]$params$tau_c$values$value
base64
?base64
??base64
decode(d[[1]]$params$tau_c$values$value)
?decode
??base64
install.packages('base64enc')
require(base64enc, quietly=TRUE)
??base64enc
base64decode(d[[1]]$params$tau_c$values$value)
base64decode(d[[1]]$params$tau_c$values$value,1)
?gsub
gsub("[\r\n]", "", d[[1]]$params$tau_c$values$value)
base64decode(v)
v = gsub("[\r\n]", "", d[[1]]$params$tau_c$values$value)
base64decode(v)
?base64decode
?unz
v = gsub("[\r\n]", "", d[[1]]$params$tau_c$values$value)
v
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
decode_command
?system
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
decodeFromDb(v)
v
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
decodeFromDb(v)
decodeFromDb(v)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
decodeFromDb(v)
pars
dv$params
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
dv$params[[par]]$values$value
decodeFromDb(dv$params[[par]]$values$value)
decode_command = "python -c 'import zlib; import sys; import numpy as np; print np.fromstring(zlib.decompress(sys.stdin.read().decode(\"base64\")))[0];'"
decodeFromDb = function(v) {
as.numeric(system(sprintf("echo -n %s | %s", v, decode_command), intern=TRUE))
}
decodeFromDb(dv$params[[par]]$values$value)
require(rmongodb,quietly=TRUE)
require(base64enc, quietly=TRUE)
decode_command = "python -c 'import zlib; import sys; import numpy as np; print np.fromstring(zlib.decompress(sys.stdin.read().decode(\"base64\")))[0];'"
decodeFromDb = function(v) {
as.numeric(system(sprintf("echo -n \"%s\" | %s", v, decode_command), intern=TRUE))
}
decodeFromDb(dv$params[[par]]$values$value)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
p[[1]]
names(p)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
p
cr
p[[1]]
cat(p[[1]])
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
cat(p[[1]])
vv = cat(p[[1]])
vv
paste(p[[1]])
paste(p[[1]], collapse='')
paste(p[[1]], collapse='\n')
paste(p[[1]], collapse='')
print(paste(p[[1]], collapse=''))
decodeFromDb(paste(p[[1]], collapse=''))
decode_command = "python -c \"import zlib; import sys; import numpy as np; print '\n'.join([ str(np.fromstring(zlib.decompress(l.decode(\"base64\")))[0]) for l in sys.stdin.readlines() ])\""
sprintf("echo -n \"%s\" | %s", v, decode_command)
v = paste(p[[1]], collapse='')
v
sprintf("echo -n \"%s\" | %s", v, decode_command)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
decode_command = "python -c \"import zlib; import sys; import numpy as np; print [ str(np.fromstring(zlib.decompress(l.decode('base64')))[0]) for l in sys.stdin.readlines() if l.strip() ]\""
decodeFromDb(paste(p[[1]], collapse=''))
v
decode_command = "python -c \"import zlib; import sys; import numpy as np; print '\\n'.join([ str(np.fromstring(zlib.decompress(l.decode('base64')))[0]) for l in sys.stdin.readlines() if l.strip() ])\""
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
v
sprintf("%s",v)
paste(p[[1]], collapse='')
paste(p[[1]], collapse='\n')
decodeFromDb(paste(p[[1]], collapse='\n'))
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
paste(p[[1]], collapse='')
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
decode_command = "python -c \"import zlib; import sys; import numpy as np; print '\\n'.join([ str(np.fromstring(zlib.decompress(l.decode('base64')))[0]) for l in sys.stdin.readlines() if l.strip() ])\"
decode_command = "python -c \"import zlib; import sys; import numpy as np; print '\\n'.join([ str(np.fromstring(zlib.decompress(l.decode('base64')))[0]) for l in sys.stdin.readlines() if l.strip() ])\""
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
p
cr
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
pn
paste(p[[pn]], collapse='')
p[["criterion"]]
names(p)
source('~/prog/alexeyche-junk/cns/cpp/r_package/r_scripts/spear_exp.R', echo=TRUE)
p
