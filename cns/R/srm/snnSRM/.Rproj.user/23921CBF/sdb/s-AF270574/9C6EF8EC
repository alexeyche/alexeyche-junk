{
    "contents" : "#!/usr/bin/RScript\nsetwd(\"~/prog/alexeyche-junk/cns/R/srm/new\")\nrequire(snnSRM)\nrequire(snowfall)\nsource('util.R')\nsource('neuron.R')\nsource('gen_spikes.R')\nsource('plot_funcs.R')\nsource('grad_funcs.R')\nsource('llh.R')\nsource('srm.R')\n\nif(!sfIsRunning()) {\n  sfInit(parallel=TRUE, cpus=10)\n  res = sfClusterEval(require('snnSRM'))\n}\nsfExport('constants')\ndir = \"/home/alexeyche/prog/sim/R\"\n\nM = 50\nN = 5\nid_m = seq(1, M)\nid_n = seq(M+1, M+N)\n\ngr1 = TSNeurons(M = M, patterns = list())\n\nfile <- \"/home/alexeyche/prog/sim/stimuli/sd1.csv\"\ngr1$loadPattern(file, 150)\nnet <- spikeMatToSpikeList(gr1$patterns[[1]]$data)\n\n\nstart_w = 5.5\n\nneurons = list()\nfor(i in 1:N) {\n  conn <- id_m\n  conn <- c(conn, id_n[id_n != id_n[i]]) # id of srm neurons: no self connections\n  w <- rep(start_w, length(conn))\n  neurons[[i]] = neuron(w = w, id_conn = conn, id = id_n[i])\n}\nnull_pattern = list()\nfor(i in 1:N) {\n  null_pattern[[i]] <- -Inf\n}\npattern = list()\npattern[[1]] <- c(-Inf, 75)\npattern[[2]] <- c(-Inf, 65)\npattern[[3]] <- c(-Inf, 50,80)\npattern[[4]] <- c(-Inf, 100)\npattern[[5]] <- c(-Inf, 10)\n\nepochs = 50\nrun_options = list(T0 = 0, Tmax = 150, dt = 0.5, learning_rate = 3, learn_window_size = 10, mode=\"run\", collect_stat=FALSE)\n\nfor(ep in 1:epochs) {\n  net[id_n] <- pattern\n  gr = grad(neurons, 0, 150, net, FALSE)\n  net[id_n] <- null_pattern\n  c(net, neurons, sprob, spot) := run_srm(neurons, net, run_options)\n  not_fired = all(sapply(net[id_n], function(sp) length(sp) == 1))\n  \n  if(!not_fired)\n    p1 = plot_rastl(net[id_n], sprintf(\"epoch %d\", ep))\n  p2 = levelplot(gr, col.regions=colorRampPalette(c(\"black\", \"white\")))\n  if(!not_fired) \n    print(p1, position=c(0, 0.5, 1, 1), more=TRUE)\n  print(p2, position=c(0, 0, 1, 0.5))\n  \n  invisible(sapply(1:N, function(i) neurons[[i]]$w <- neurons[[i]]$w + run_options$learning_rate * gr[,i] ))\n  \n}\n\n\n",
    "created" : 1389277567547.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "818782558",
    "id" : "9C6EF8EC",
    "lastKnownWriteTime" : 1389259913,
    "path" : "~/my/git/alexeyche-junk/cns/R/srm/new/test_llh.R",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}