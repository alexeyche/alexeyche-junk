source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
setwd("~/prog/alexeyche-junk/ml/dbn")
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hid.states
n.h <- ncol(model$W)
hid.probs <- prop_up(data, model)
hid.states <- sample_bernoulli(hid.probs)
hist(hid.probs)
hid.probs
#!/usr/bin/RScript
source('rbm.R')
source('sys.R')
plot_data <- function(data,model) {
n.h <- ncol(model$W)
hid.probs <- prop_up(data, model)
hid.states <- sample_bernoulli(hid.probs)
hist(hid.probs)
#hist(data[hid.states == 1], col='red', xlim=c(min(data), max(data)) )
#hist(data[hid.states == 0], col='blue',xlim=c(min(data), max(data)) )
#plot(density(data))
#high_energy <- data[free_energy(data,model) > 0]
#points(high_energy, rep(0,length(high_energy)), col='red')
}
# o    | j = 1
# o     | i = 1
num.vis <- 1
num.hid <- 2
num.cases <- 100
num.dims <- 1
err.total <- 0
train.params = list(e.w = 0.1, e.v = 1, e.h = 1, w_cost = 0.0002,
init.moment = 0.5, fin.moment = 0.9,
epochs = 50, cd.iter = 1)
set.seed(2)
model <- list(W = array(0.1*rnorm(num.vis*num.hid),dim=c(num.vis,num.hid)), # visible units for row, hidden units for col
vis_bias = array(0,dim = c(1,num.vis)),
hid_bias = array(0,dim = c(1,num.hid)),
num.cases = num.cases)
model$W
prop_up(data,model)
data
data <- as.matrix(rnorm(num.cases, mean=1, sd=1), ncol=1) # mean = 0, sd = 1
prop_up(data,model)
hid_probs <- prop_up(data,model) # v*W + bias_v
hid_probs.w <- hid_probs
View(hid_probs.w)
hid_states <- sample_bernoulli(hid_probs.w)
View(hid_states)
vis_probs.fantasy <- prop_down(hid_states, model)
View(vis_probs.fantasy)
hid_probs.w <- prop_up(vis_sample.fantasy, model)
vis_sample.fantasy <- sample_bernoulli(vis_probs.fantasy)
hid_probs.w <- prop_up(vis_sample.fantasy, model)
View(hid_probs.w)
hid_probs.fantasy <- hid_probs.w
err <- sum((data - vis_sample.fantasy)^2)
err.total <- err.total + err
E.free.mean <- sum(free_energy(data, model))/num.cases
momentum <- fin.moment
if (epoch <= 5) {
momentum <- init.moment
}
# deravatives over log p(v)
# d_log_p(v) / d_W_ij
W.inc <- momentum*W.inc + e.w*( ( t(data) %*% hid_probs - t(vis_sample.fantasy) %*% hid_probs.fantasy)/num.cases - w_cost*model$W)
# d_log_p(v) / d_hid_bias_j
hid_bias.inc <- momentum*hid_bias.inc + e.h*(sum.row(hid_probs) - sum.row(hid_probs.fantasy))/num.cases
# d_log_p(v) / d_vis_bias_i
vis_bias.inc <- momentum*vis_bias.inc + e.v*(sum.row(data) - sum.row(vis_sample.fantasy))/num.cases
model$W <- model$W + W.inc
model$hid_bias <- model$hid_bias + hid_bias.inc
model$vis_bias <- model$vis_bias + vis_bias.inc
W.inc <- hid_bias.inc <- vis_bias.inc <- 0
# deravatives over log p(v)
# d_log_p(v) / d_W_ij
W.inc <- momentum*W.inc + e.w*( ( t(data) %*% hid_probs - t(vis_sample.fantasy) %*% hid_probs.fantasy)/num.cases - w_cost*model$W)
# d_log_p(v) / d_hid_bias_j
hid_bias.inc <- momentum*hid_bias.inc + e.h*(sum.row(hid_probs) - sum.row(hid_probs.fantasy))/num.cases
# d_log_p(v) / d_vis_bias_i
vis_bias.inc <- momentum*vis_bias.inc + e.v*(sum.row(data) - sum.row(vis_sample.fantasy))/num.cases
model$W <- model$W + W.inc
model$hid_bias <- model$hid_bias + hid_bias.inc
model$vis_bias <- model$vis_bias + vis_bias.inc
momentum <- fin.moment
if (epoch <= 5) {
momentum <- init.moment
}
epoch <- 1
if (epoch <= 5) {
momentum <- init.moment
}
for (v in 1:length(train.params)) assign(names(train.params)[v], train.params[[v]])
momentum <- fin.moment
if (epoch <= 5) {
momentum <- init.moment
}
W.inc <- momentum*W.inc + e.w*( ( t(data) %*% hid_probs - t(vis_sample.fantasy) %*% hid_probs.fantasy)/num.cases - w_cost*model$W)
# d_log_p(v) / d_hid_bias_j
hid_bias.inc <- momentum*hid_bias.inc + e.h*(sum.row(hid_probs) - sum.row(hid_probs.fantasy))/num.cases
# d_log_p(v) / d_vis_bias_i
vis_bias.inc <- momentum*vis_bias.inc + e.v*(sum.row(data) - sum.row(vis_sample.fantasy))/num.cases
model$W <- model$W + W.inc
model$hid_bias <- model$hid_bias + hid_bias.inc
model$vis_bias <- model$vis_bias + vis_bias.inc
View(W.inc)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
n.h <- ncol(model$W)
vis.states <- data
for(i in 1:100) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
hist(vis.states)
vis.states
n.h <- ncol(model$W)
vis.states <- data
for(i in 1:1) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.states
hist(vis.states)
data[vis.states == 1]
hist(data)
points(data[vis.states == 1], col='red')
plot(density(data))
points(data[vis.states == 1], rep(0, length(data[vis.states == 1])), col='red')
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model
hid.probs <- prop_up(data, model)
hid.probs
hid.states <- sample_bernoulli(hid.probs)
View(vis.states)
image(hid.states)
?image
hearmap(hid.states)
heatmap(hid.states)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model$W
hid.probs <- prop_up(data, model)
hid.states <- sample_bernoulli(hid.probs)
hid.states
heatmap(hid.states)
require(ggplot2)
install.packages(ggplot2)
install.packages(ggplot)
install.packages('ggplot2')
install.packages('ggplot')
require(ggplot2)
?ggplot2
ggplot2(hid.states)
ggplot2::ggplot(hid.states)
melt
melt(hit.states)
??melt
install.packages('reshape2')
install.packages("reshape2")
require(reshape2)
melt(hit.states)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
n.h <- ncol(model$W)
vis.states <- data
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
melt(hit.states)
melt(hid.states)
ggplot(melt(hid.states))
require(ggplot2)
ggplot(melt(hid.states))
ggplot(melt(hid.states),aes(Var1,Var2))+geom_tile(aes(fill=value))+scale_fill_gradient(low="white",high="black",limits=c(0,1))+coord_equal()
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model$W
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model$W
model$W
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hid.probs <- prop_up(data, model)
hid.probs
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
data
hist(data)
hid.probs <- prop_up(data, model)
ggplot(melt(hid.probs),aes(Var1,Var2))+
geom_tile(aes(fill=value))+
scale_fill_gradient(low="white",high="black",limits=c(0,1))+
coord_equal()
hid.probs
source('~/.active-rstudio-document', echo=TRUE)
hid.probs <- prop_up(data, model)
ggplot(melt(hid.probs),aes(Var1,Var2))+
geom_tile(aes(fill=value))+
scale_fill_gradient(low="white",high="black",limits=c(0,1))+
coord_equal()
source('~/.active-rstudio-document', echo=TRUE)
hid.probs <- prop_up(data, model)
ggplot(melt(hid.probs),aes(Var1,Var2))+
geom_tile(aes(fill=value))+
scale_fill_gradient(low="white",high="black",limits=c(0,1))+
coord_equal()
plot_data(data,model)
plot_data(data,model)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model
vis.states <- data
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
View(hid.probs)
View(vis.probs)
vis.probs > 4.847472e-167
par(mfrow=c(1,2)); hist(data); hist(data[vis.probs > 4.847472e-167])
par(mfrow=c(1,2)); hist(data); hist(data[vis.probs > 4.847472e-167], xlim=c(-2,2))
par(mfrow=c(2,2)); hist(data); hist(data[vis.probs > 4.847472e-167], xlim=c(-2,2)); hist(data[vis.probs <= 4.847472e-167], xlim=c(-2,2))
par(mfrow=c(2,2)); hist(data); hist(data[vis.probs > 4.847472e-167], xlim=c(-2,2))
par(mfrow=c(2,2)); hist(data); hist(data[vis.probs > 4.847472e-167], xlim=c(-2,2))
par(mfrow=c(2,2)); hist(data); hist(data[vis.probs > 4.847472e-167], xlim=c(-2,2)); hist(data[vis.probs <= 4.847472e-167], xlim=c(-2,2))
source('~/.active-rstudio-document', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(model$W)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model$W
model$vis_bias
model$hid_bias
plot_data(data,model)
vis.states <- data
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
vis.states
vis.probs
vis.probs <- prop_down(hid.probs,model)
vis.probs
hist(vis.probs)
data[vis.probs == 1]
hist(data[vis.probs == 1], xlim=c(-2,2)
hist(data[vis.probs == 1], xlim=c(-2,2))
hist(data)
hist(data[vis.probs < 1], xlim=c(-2,2))
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
plot(data,model$W)
plot(data,model)
plot_data(data,model)
model$W
vis.states <- data
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.probs
par(mfrow = c(2,2))
hist(data)
hist(data[vis.probs > 1], xlim=c(-2,2)
)
hist(data[vis.probs > 1], xlim=c(-2,2))
hist(data[vis.probs == 1], xlim=c(-2,2))
hist(data[vis.probs >0], xlim=c(-2,2))
hist(data[vis.probs <0], xlim=c(-2,2))
hist(data[vis.probs <=0], xlim=c(-2,2))
par(mfrow = c(2,2))
hist(data)
hist(data[vis.probs == 1], xlim=c(-0.5,1.5))
hist(data[vis.probs == 0], xlim=c(-0.5,1.5))
hist(data[vis.probs > 0 and vis.probs<1], xlim=c(-0.5,1.5))
hist(data[(vis.probs > 0) and (vis.probs<1)], xlim=c(-0.5,1.5))
hist(data[(vis.probs > 0)&(vis.probs<1)], xlim=c(-0.5,1.5))
View(vis.probs)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
max(data)
min(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
min(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
model
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states <- data
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
vis.probs
hist(vis.probs)
for(i in 1:200) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.probs
for(i in 1:2000) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.probs
hist(vis.probs)
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states <- data
for(i in 1:2000) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.probs
hist(vis.probs)
hist(data)
hist(vis.probs)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
plot(density(data))
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states <- data
for(i in 1:2000) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.probs
hist(vis.probs)
vis.states
hist(data[vis.states == 1])
hist(data[vis.states == 0])
hist(data[vis.states == 1])
hist(data[vis.states == 2])
hist(data[vis.states == 0])
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states <- data
for(i in 1:2000) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.probs
vis.states
hist(data[vis.states == 0])
hist(data[vis.states == 1])
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
hist(data)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
data
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/.active-rstudio-document', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
data
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states <- data
for(i in 1:2000) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.states
data[vis.states == 1 ]
data[vis.states == 0 ]
plot(density(data)
plot(density(data))
points(data[vis.states == 1], col = 'red')
points(data[vis.states == 1],rep(0,length(data[vis.states == 1])), col = 'red')
points(data[vis.states == 0],rep(0,length(data[vis.states == 1])), col = 'red')
points(data[vis.states == 0],rep(0,length(data[vis.states == 0])), col = 'red')
plot(density(data))
points(data[vis.states == 1],rep(0,length(data[vis.states == 1])), col = 'red')
points(data[vis.states == 0],rep(0,length(data[vis.states == 0])), col = 'blue')
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
data
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
source('~/prog/alexeyche-junk/ml/dbn/rbm_toy.R', echo=TRUE)
vis.states <- data
for(i in 1:2000) {
hid.probs <- prop_up(vis.states, model)
hid.states <- sample_bernoulli(hid.probs)
vis.probs <- prop_down(hid.states,model)
vis.states <- sample_bernoulli(vis.probs)
}
vis.states
vis.probs
